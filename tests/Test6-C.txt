.extern print
.extern handler

.section .main
ld $0x1000, %sp
ld $handler, %r1
csrwr %r1, %handler

ld $timerMsg1, %r1
call print
call wait50000000

ld $1, %r1
st %r1, 0xFFFFFF10
ld $timerMsg2, %r1
call print
call wait50000000

ld $4, %r1
st %r1, 0xFFFFFF10
ld $timerMsg3, %r1
call print
call wait50000000

int
ld $endMsg, %r1
call print
halt

wait50000000:
push %r1
push %r2
push %r3
ld $waitMsg, %r1
call print
ld $0, %r1
ld $1000000, %r2
ld $1, %r3
loop:
beq %r1, %r2, end
add %r3, %r1
jmp loop
end:
pop %r3
pop %r2
pop %r1
ret

.section .data
timerMsg1: .ascii "Timer setting = 0 (500)\n"
timerMsg2: .ascii "Timer setting = 1 (1000)\n"
timerMsg3: .ascii "Timer setting = 4 (5000)\n"
endMsg: .ascii "The end\n"
waitMsg: .ascii "Inside waiting\n"
.end
